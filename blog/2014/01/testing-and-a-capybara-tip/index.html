<!DOCTYPE html>
<html lang='en-us'>
  <head>
    <meta charset='utf-8'>
    <meta content='width=device-width, initial-scale=1' name='viewport'>
    <title>testing and a capybara tip | blog | cbjohnson</title>
    <link href="/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/application.js" type="text/javascript"></script>
  </head>
  <body>
    <div class='wrapper'>
      <div class='container'>
        <header class='head'>
          <h1><a href="/">cbjohnson</a></h1>
        </header>
        <aside class='sidenav'>
          <nav>
            <ul>
              <div class='menu'>
                <li>
                  <a href="/">Info</a>
                </li>
                <li class='active'>
                  <a href="/blog/">Blog</a>
                </li>
                <li>
                  <a href="/blog/archive/">Archive</a>
                </li>
                <li>
                  <a href="/contact/">Contact</a>
                </li>
              </div>
              <div class='social'>
                <li><a href="https://twitter.com/charbajo">@charbajo</a></li>
                <li><a href="https://github.com/charlesbjohnson">GitHub</a></li>
                <li><a href="http://www.last.fm/user/cbj7777">Last.fm</a></li>
              </div>
            </ul>
          </nav>
        </aside>
        <section class='main'>
          <header class='head-main'>
            <h2>Blog</h2>
          </header>
          <section class='content-main'>
            <article>
              <header>
                <h3>Testing and a Capybara tip</h3>
                <p class='blog-stamp'>
                  <time datetime='2014-01-15 17:16:00 -0500'>Jan 15, 2014</time>
                </p>
              </header>
              <section>
                <p>When I first started learning Ruby one of the things that I read and heard over
                and over again was how great the libraries for testing were. Coming from
                C# and .NET, I had spent a lot of time working with <a href="http://www.specflow.org/">SpecFlow</a>,
                <a href="https://code.google.com/p/mb-unit/">mb-unit</a>, and <a href="https://github.com/ayende/rhino-mocks">Rhino Mocks</a> in a TDD/BDD-ish environment.
                I already knew how incredibly useful a good test suite was and how much more
                efficient it could allow you to be when it came to making new features and
                refactoring old ones.</p>
                
                <p>What I didn&rsquo;t realize, though, was the extent to which Rubyists tested their
                applications. In .NET, everything was heavily unit tested. Although we wrote
                Cucumber-style specs, they were mainly being used as a more readable alternative
                to the plain xUnit-style tests. We stuck with plain old unit tests with mocked
                dependencies and relied on manual testing (or sometimes our CI server) to catch
                issues with integration. It was a pain.</p>
                
                <p>Meanwhile, plenty of Rubyists had already been using tons of great testing
                libraries. What was crazy about it all of it, to me at least, was what they
                were able to test with gems like Capybara (or Rack::Test/Webrat before that).
                Although I&rsquo;ve since managed to pick up the pieces, the revelation that
                you could test an entire application (JavaScript included) with straightforward
                tests/specs in Ruby blew my mind.</p>
                
                <p><img title="I know, I know. You must be sick of this one by now." alt="mind-blown" src="/blog/2014/01/testing-and-a-capybara-tip/mind-blown.gif" /></p>
                
                <p>In my newest project, for example, I&rsquo;ve been using Capybara with
                <a href="https://github.com/jonleighton/poltergeist">Poltergeist</a>. Whenever I&rsquo;m using Capybara, I tend to want to
                just play with the API. This can be done by just fiddling with my tests and
                constantly rerunning them, but I found a an even simpler way to just use
                Capybara from Pry or IRB with this script (<code>pry_capybara.rb</code>):</p>
                <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre></td><td class="code"><pre><span class="c1"># Simple script to be able to quickly interact with the capybara API from pry</span>&#x000A;&#x000A;<span class="nb">require</span> <span class="s1">'capybara/poltergeist'</span>&#x000A;<span class="no">Capybara</span><span class="p">.</span><span class="nf">run_server</span> <span class="o">=</span> <span class="kp">false</span>&#x000A;<span class="no">Capybara</span><span class="p">.</span><span class="nf">current_driver</span> <span class="o">=</span> <span class="ss">:poltergeist</span>&#x000A;<span class="kp">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span></pre></td></tr></tbody></table></div>
                <p>Capybara will complain about being included in the global scope, but as long as
                you are just using this for one-off Pry sessions, it shouldn&rsquo;t matter. You can
                use it like this:</p>
                <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre><pre class="lineno">7</pre><pre class="lineno">8</pre><pre class="lineno">9</pre><pre class="lineno">10</pre><pre class="lineno">11</pre><pre class="lineno">12</pre><pre class="lineno">13</pre><pre class="lineno">14</pre><pre class="lineno">15</pre><pre class="lineno">16</pre><pre class="lineno">17</pre><pre class="lineno">18</pre><pre class="lineno">19</pre></td><td class="code"><pre><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">require_relative</span> <span class="s1">'pry_capybara'</span>&#x000A;<span class="n">including</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span> <span class="k">in</span> <span class="n">the</span> <span class="n">global</span> <span class="n">scope</span> <span class="n">is</span> <span class="n">not</span> <span class="n">recommended!</span>&#x000A;<span class="o">=&gt;</span> <span class="kp">true</span>&#x000A;&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="c1"># if you are running your server locally</span>&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">visit</span> <span class="s1">'http://localhost:3000'</span>&#x000A;<span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"status"</span><span class="o">=&gt;</span><span class="s2">"success"</span><span class="p">}</span>&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">title</span>&#x000A;<span class="o">=&gt;</span> <span class="s2">"MyApp"</span>&#x000A;&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="c1"># or if you want to just mess around with any site</span>&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">visit</span> <span class="s1">'https://news.ycombinator.com'</span>&#x000A;<span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"status"</span><span class="o">=&gt;</span><span class="s2">"success"</span><span class="p">}</span>&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">all</span><span class="p">(</span><span class="s1">'.title &gt; a'</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:text</span><span class="p">).</span><span class="nf">first</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>&#x000A;<span class="o">=&gt;</span> <span class="o">[</span><span class="s2">"Super successful companies"</span><span class="p">,</span>&#x000A; <span class="s2">"Show HN: Kimono – Never write a web scraper again"</span><span class="p">,</span>&#x000A; <span class="s2">"The Productivity Cycle"</span><span class="p">,</span>&#x000A; <span class="s2">"Coming soon: Stripe CTF3, distributed systems edition"</span><span class="p">,</span>&#x000A; <span class="s2">"List of languages that compile to JS"</span><span class="o">]</span></pre></td></tr></tbody></table></div>
                <p>Although it&rsquo;s small and very simple, it&rsquo;s been really useful to me for when I&rsquo;m
                writing feature specs and (soon to be discussed in another post) page objects.</p>
                
                <p>I know what you must be thinking by now though&hellip;</p>
                
                <blockquote>
                <p>&ldquo;It&rsquo;s 2014! We&rsquo;ve been doing this kind of thing for years! We&rsquo;re
                even doing this in JavaScript now! Get with the times!&rdquo;</p>
                </blockquote>
                
                <p>Although you&rsquo;d be right to think such a thing, it&rsquo;s still a bit crazy how
                powerful libraries like these are. And this is only for testing. Don&rsquo;t even get
                me started on the ridiculousness of the <a href="http://oridomi.com/">origami-image-folding</a>,
                <a href="http://theonion.github.io/fartscroll.js/">fart-scrolling</a>, <a href="https://developer.mozilla.org/en-US/demos/detail/bananabread">first-person-shooter&#39;ing</a> that
                is the current state of JavaScript.</p>
              </section>
            </article>
          </section>
        </section>
      </div>
    </div>
    <footer class='footer'>
      <p>
        <small>
          © 2014 Charles B Johnson. Made with
          <a href="http://middlemanapp.com/">Middleman</a>
          and
          <a href="https://github.com/charlesbjohnson/cbjohnson.info">GitHub</a>.
        </small>
      </p>
    </footer>
  </body>
</html>

