<!DOCTYPE html>
<html lang='en-us'>
  <head>
    <meta charset='utf-8'>
    <meta content='width=device-width, initial-scale=1' name='viewport'>
    <title>blog | cbjohnson</title>
    <link href="/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/application.js" type="text/javascript"></script>
  </head>
  <body>
    <div class='wrapper'>
      <div class='container'>
        <header class='head'>
          <h1><a href="/">cbjohnson</a></h1>
        </header>
        <aside class='sidenav'>
          <nav>
            <ul>
              <div class='menu'>
                <li>
                  <a href="/">Info</a>
                </li>
                <li class='active'>
                  <a href="/blog/">Blog</a>
                </li>
                <li>
                  <a href="/blog/archive/">Archive</a>
                </li>
                <li>
                  <a href="/contact/">Contact</a>
                </li>
              </div>
              <div class='social'>
                <li><a href="https://twitter.com/charbajo">@charbajo</a></li>
                <li><a href="https://github.com/charlesbjohnson">GitHub</a></li>
                <li><a href="http://www.last.fm/user/cbj7777">Last.fm</a></li>
              </div>
            </ul>
          </nav>
        </aside>
        <section class='main'>
          <header class='head-main'>
            <h2>Blog</h2>
          </header>
          <section class='content-main'>
            <article>
              <header>
                <h3><a href="/blog/2014/02/testing-vim/">Testing for Vim</a></h3>
                <p class='blog-stamp'>
                  <time datetime='2014-02-07 13:16:00 -0500'>Feb  7, 2014</time>
                </p>
              </header>
              <div class='content-article'>
                <p>I really enjoy using Vim. One of the best things about Vim is the community of
                plugins available. I&rsquo;ve spent a small amount of time learning enough Vimscript
                to be able to understand what is happening in my vimrc (thanks to the great
                <a href="https://leanpub.com/learnvimscriptthehardway">book</a> by Steve Losh, which is also available for free
                <a href="http://learnvimscriptthehardway.stevelosh.com/">here</a>) but I&rsquo;ve been really fascinated by the amount of work
                that must go into making a Vim plugin. I feel like it must be fairly challenging
                considering how old Vim is, how scarce the resources for it are (beyond <code>:help</code>,
                of course), and how seemingly bizarre/arcane Vimscript is. Another thing that
                puzzled me was how a plugin author managed to effectively test their plugin, if
                they did at all.</p>
                
                <p>Some plugins separate the core of their logic from Vim entirely
                (such as <a href="https://github.com/Valloric/YouCompleteMe">YouCompleteMe</a> and <a href="https://github.com/marijnh/tern">Tern</a> of <a href="https://github.com/marijnh/tern_for_vim">tern_for_vim</a>)
                which also allows them to test the way that they would normally (whether it is
                through unit tests or specs or whatever else). If I&rsquo;ve learned anything from 
                working with Ruby and Rails, however, it is that there is always room for
                integration testing. This led me to an interesting question: how do plugin
                authors perform integration testing?  And not even just for Vim&hellip; The same
                could be said about <a href="https://www.jetbrains.com/resharper/">ReSharper</a> and Visual Studio. What do they do?
                What tools are available and what <em>can</em> they do?</p>
                
                <p>The other day I was looking through the source of <a href="https://github.com/svermeulen/vim-easyclip">vim-easyclip</a>
                (great plugin, by the way, I recommend it) and I saw something peculiar.
                25% of the repo is written in Ruby. Turns out there is <code>spec/</code> directory with
                a bunch of RSpec in it. Then I saw this line in one of the specs:</p>
                <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="vi">@vim</span> <span class="o">=</span> <span class="no">Vimbot</span><span class="o">::</span><span class="no">Driver</span><span class="p">.</span><span class="nf">new</span></pre></td></tr></tbody></table></div>
                <p><img title="My face when" alt="intriguing" src="/blog/2014/02/testing-vim/intriguing.gif" /></p>
                
                <p>It turns out that in the case of Vim that there are actually a few tools
                specifically made for testing Vim plugins. They&rsquo;re even written in Ruby! Who
                would have guessed?  <a href="https://github.com/maxbrunsfeld/vimbot">vimbot</a> is the plugin used by easyclip but it
                doesn&rsquo;t look like it has been updated in some time. There&rsquo;s also
                <a href="https://github.com/AndrewRadev/vimrunner">vimrunner</a> and a few others from <a href="https://stackoverflow.com/questions/3029882/tools-for-testing-vim-plugins">this</a>
                question on StackOverlow.</p>
                
                <p>I have no idea why this excites me or if these tools are even all that great but
                I thought that this was pretty neat nonetheless. I&rsquo;m always really surprised
                by the extent to which Ruby is used for testing and I&rsquo;d like to know how these
                libraries actually work. Who knows, it may not even be all that special.</p>
                
                <p>That&rsquo;s all I got for this time. I just felt like sharing something I thought was
                interesting. Thanks for reading.</p>
              </div>
            </article>
            <hr class='post-separator'>
            <article>
              <header>
                <h3><a href="/blog/2014/01/page-objects-with-siteprism/">Page objects with SitePrism</a></h3>
                <p class='blog-stamp'>
                  <time datetime='2014-01-16 18:02:00 -0500'>Jan 16, 2014</time>
                </p>
              </header>
              <div class='content-article'>
                <p>If you read my last post then you probably already know that I&rsquo;m a fan of
                Capybara. As much as I like it, though, it can be difficult to follow specs
                that rely on intimate details of the view in order to determine the success or
                failure of a test case. Here&rsquo;s a really simple snippet from a feature spec of
                a recent project (<code>spec/features/sign_up_spec.rb</code>):</p>
                <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre><pre class="lineno">7</pre><pre class="lineno">8</pre><pre class="lineno">9</pre><pre class="lineno">10</pre><pre class="lineno">11</pre><pre class="lineno">12</pre><pre class="lineno">13</pre><pre class="lineno">14</pre><pre class="lineno">15</pre><pre class="lineno">16</pre><pre class="lineno">17</pre><pre class="lineno">18</pre><pre class="lineno">19</pre><pre class="lineno">20</pre><pre class="lineno">21</pre><pre class="lineno">22</pre><pre class="lineno">23</pre><pre class="lineno">24</pre><pre class="lineno">25</pre><pre class="lineno">26</pre><pre class="lineno">27</pre><pre class="lineno">28</pre><pre class="lineno">29</pre><pre class="lineno">30</pre><pre class="lineno">31</pre><pre class="lineno">32</pre><pre class="lineno">33</pre></td><td class="code"><pre><span class="n">feature</span> <span class="s1">'sign up page'</span> <span class="k">do</span>&#x000A;  <span class="c1"># Specific strings or phrases that are used to interact with the page</span>&#x000A;  <span class="c1"># are consolidated in case they change later on.</span>&#x000A;  <span class="n">given</span><span class="p">(</span><span class="ss">:signup_path</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'/signup'</span> <span class="p">}</span>&#x000A;  <span class="n">given</span><span class="p">(</span><span class="ss">:create_account</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'Create account'</span> <span class="p">}</span>&#x000A;  <span class="n">given</span><span class="p">(</span><span class="ss">:signup</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'Sign up'</span> <span class="p">}</span>&#x000A;&#x000A;  <span class="n">background</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">signup_path</span> <span class="p">}</span>&#x000A;&#x000A;  <span class="n">scenario</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_title</span> <span class="n">signup</span> <span class="p">}</span>&#x000A;  <span class="n">scenario</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_no_link</span> <span class="n">signup</span><span class="p">,</span> <span class="ss">href: </span><span class="n">signup_path</span> <span class="p">}</span>&#x000A;&#x000A;  <span class="n">scenario</span> <span class="s1">'with valid credentials'</span> <span class="k">do</span>&#x000A;    <span class="n">password</span> <span class="o">=</span> <span class="s1">'password'</span>&#x000A;&#x000A;    <span class="n">within</span> <span class="s1">'#signup'</span> <span class="k">do</span>&#x000A;      <span class="n">fill_in</span> <span class="s1">'#user_email'</span><span class="p">,</span> <span class="ss">with: </span><span class="s1">'foo@bar.com'</span>&#x000A;      <span class="n">fill_in</span> <span class="s1">'#user_password'</span><span class="p">,</span> <span class="ss">with: </span><span class="n">password</span>&#x000A;      <span class="n">fill_in</span> <span class="s1">'#user_password_confirmation'</span><span class="p">,</span> <span class="ss">with: </span><span class="n">password</span>&#x000A;      <span class="n">click_on</span> <span class="n">create_account</span>&#x000A;    <span class="k">end</span>&#x000A;&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="n">current_path</span><span class="p">).</span><span class="nf">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">'.alert-success'</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="n">scenario</span> <span class="s1">'with invalid credentials'</span> <span class="k">do</span>&#x000A;    <span class="n">click_on</span> <span class="n">create_account</span>&#x000A;&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="n">current_path</span><span class="p">).</span><span class="nf">to</span> <span class="n">eql</span><span class="p">(</span><span class="n">signup_path</span><span class="p">)</span>&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">'.alert-warning'</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span></pre></td></tr></tbody></table></div>
                <p>I&rsquo;m using the Capybara acceptance test syntax (I think it&rsquo;s more practical
                than using Cucumber). I&rsquo;m only testing a few things here. To summarize the
                intent of the specs in plain English:</p>
                
                <ul>
                <li>When the user visits the sign up page&hellip;
                
                <ul>
                <li>It should have the right title.</li>
                <li>There should not be a button linking to the same sign up page.</li>
                <li>And creates an account with&hellip;
                
                <ul>
                <li>Valid information he/she should be redirected to the main (root) page
                and notified that the process was a success.</li>
                <li>Invalid information he/she should stay on the signup page and be
                warned that the process was unsuccessful.</li>
                </ul></li>
                </ul></li>
                </ul>
                
                <p>Fairly standard, right? So what&rsquo;s the problem here, then? Well, you may not
                have caught it but the actual specs on their own don&rsquo;t really speak to my intent.
                What can I do to fix it though?</p>
                
                <p>If I really wanted to incorporate my intent into the tests I could break them
                down more and give them better descriptions. For instance, the
                <code>invalid credentials</code> scenario, redux:</p>
                <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre><pre class="lineno">7</pre><pre class="lineno">8</pre><pre class="lineno">9</pre><pre class="lineno">10</pre><pre class="lineno">11</pre><pre class="lineno">12</pre><pre class="lineno">13</pre><pre class="lineno">14</pre><pre class="lineno">15</pre><pre class="lineno">16</pre></td><td class="code"><pre><span class="n">feature</span> <span class="s1">'sign up page'</span> <span class="k">do</span>&#x000A;&#x000A;  <span class="p">.</span><span class="nf">.</span><span class="o">.</span>&#x000A;&#x000A;  <span class="n">feature</span> <span class="s1">'with invalid credentials'</span> <span class="k">do</span>&#x000A;    <span class="n">background</span> <span class="p">{</span> <span class="n">click_on</span> <span class="n">create_account</span> <span class="p">}</span>&#x000A;&#x000A;    <span class="n">scenario</span> <span class="s1">'returns to the signup page'</span> <span class="k">do</span>&#x000A;      <span class="n">expect</span><span class="p">(</span><span class="n">current_path</span><span class="p">).</span><span class="nf">to</span> <span class="n">eql</span><span class="p">(</span><span class="n">signup_path</span><span class="p">)</span>&#x000A;    <span class="k">end</span>&#x000A;&#x000A;    <span class="n">scenario</span> <span class="s1">'is warned that it was a failure'</span> <span class="k">do</span>&#x000A;      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">'.alert-warning'</span><span class="p">)</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span></pre></td></tr></tbody></table></div>
                <p>This seems a little better. It fits with the &lsquo;one assertion/expectation per
                test&rsquo; mantra that tends to be a good heuristic. Now if one of these expectations
                failed I would at least have a good description to remind me of what the
                test was for and what I would need to do to fix it.</p>
                
                <p>There are still a few problems though. What is <code>&#39;.alert-warning&#39;</code> all about?
                If you&rsquo;ve worked with Bootstrap then you probably know, otherwise you could just
                guess and maybe take a look at the views later to find out. What about all
                of those strings that are consolidated at the start? It&rsquo;s a little strange, too,
                but necessary in case the view changes and our points of interaction are no longer
                there. A similar thing could probably be done with the alert selectors&hellip;</p>
                
                <p>Overall, though, this is still pretty unsatisfactory. All I care about with
                this spec is if the feature is intact. The specifics of the view that are
                involved are ancillary to the work I am trying to do here. This is where
                page objects can come in handy.</p>
                
                <p>After reading one of Thoughtbot&rsquo;s <a href="http://robots.thoughtbot.com/better-acceptance-tests-with-page-objects">posts</a> about page objects, I decided
                to see if it could help me. At first I tried to make my own simple base page
                object but I quickly decided that it would be easier to just see what libraries
                were available rather than trying to invent <a href="https://www.ruby-toolbox.com/projects/fucking-page-objects">yet another</a>.
                The one I ended up using is called <a href="https://github.com/natritmeyer/site_prism">SitePrism</a> (there is also
                <a href="https://github.com/cheezy/page-object">page-object</a> but I&rsquo;m not sure if it works with Poltergeist).</p>
                
                <p>With a page object representing the sign up page, I could write my specs like so:</p>
                <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre><pre class="lineno">7</pre><pre class="lineno">8</pre><pre class="lineno">9</pre><pre class="lineno">10</pre><pre class="lineno">11</pre><pre class="lineno">12</pre><pre class="lineno">13</pre><pre class="lineno">14</pre><pre class="lineno">15</pre><pre class="lineno">16</pre><pre class="lineno">17</pre><pre class="lineno">18</pre><pre class="lineno">19</pre><pre class="lineno">20</pre><pre class="lineno">21</pre><pre class="lineno">22</pre><pre class="lineno">23</pre><pre class="lineno">24</pre><pre class="lineno">25</pre><pre class="lineno">26</pre><pre class="lineno">27</pre><pre class="lineno">28</pre><pre class="lineno">29</pre><pre class="lineno">30</pre><pre class="lineno">31</pre><pre class="lineno">32</pre><pre class="lineno">33</pre></td><td class="code"><pre><span class="n">feature</span> <span class="s1">'sign up page'</span> <span class="k">do</span>&#x000A;  <span class="n">given!</span><span class="p">(</span><span class="ss">:app</span><span class="p">)</span> <span class="p">{</span> <span class="no">Pages</span><span class="o">::</span><span class="no">App</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>&#x000A;  <span class="n">given!</span><span class="p">(</span><span class="ss">:signup_page</span><span class="p">)</span> <span class="p">{</span> <span class="n">app</span><span class="p">.</span><span class="nf">signup</span> <span class="p">}</span>&#x000A;&#x000A;  <span class="n">background</span> <span class="k">do</span>&#x000A;    <span class="n">signup_page</span><span class="p">.</span><span class="nf">load</span>&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="n">signup_page</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_logged_out</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="n">scenario</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">signup_page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_correct_title</span> <span class="p">}</span>&#x000A;  <span class="n">scenario</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">signup_page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_no_signup_button</span> <span class="p">}</span>&#x000A;&#x000A;  <span class="n">scenario</span> <span class="s1">'with valid credentials'</span> <span class="k">do</span>&#x000A;    <span class="n">signup_page</span><span class="p">.</span><span class="nf">fill_in_form</span><span class="p">(</span><span class="ss">valid: </span><span class="kp">true</span><span class="p">)</span>&#x000A;    <span class="n">signup_page</span><span class="p">.</span><span class="nf">create_account</span>&#x000A;&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="n">signup_page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_success_message</span>&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="n">signup_page</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_logged_in</span>&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="nf">home</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_displayed</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="n">scenario</span> <span class="s1">'with invalid credentials'</span> <span class="k">do</span>&#x000A;    <span class="n">signup_page</span><span class="p">.</span><span class="nf">fill_in_form</span><span class="p">(</span><span class="ss">valid: </span><span class="kp">false</span><span class="p">)</span>&#x000A;    <span class="n">signup_page</span><span class="p">.</span><span class="nf">create_account</span>&#x000A;&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="n">signup_page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_alert_message</span>&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="n">signup_page</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_logged_out</span>&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="n">signup_page</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_displayed</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="p">.</span><span class="nf">.</span><span class="o">.</span>&#x000A;&#x000A;<span class="k">end</span></pre></td></tr></tbody></table></div>
                <p>Much more readable and to the point. I&rsquo;ve deviated from the previous example
                and grouped my expectations together again. In this case I feel, however, I think
                that it&rsquo;s more acceptable since each line maps directly to one of my intentions
                for this feature.</p>
                
                <p>As far as the actual page object goes, my base page object is actually doing
                most of the work here since the majority of the logic isn&rsquo;t limited to just
                the sign up page (it is used in a login page too, for example). It looks like
                this:</p>
                <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre><pre class="lineno">7</pre><pre class="lineno">8</pre><pre class="lineno">9</pre><pre class="lineno">10</pre><pre class="lineno">11</pre><pre class="lineno">12</pre><pre class="lineno">13</pre><pre class="lineno">14</pre><pre class="lineno">15</pre><pre class="lineno">16</pre><pre class="lineno">17</pre><pre class="lineno">18</pre><pre class="lineno">19</pre><pre class="lineno">20</pre><pre class="lineno">21</pre><pre class="lineno">22</pre><pre class="lineno">23</pre><pre class="lineno">24</pre><pre class="lineno">25</pre><pre class="lineno">26</pre><pre class="lineno">27</pre><pre class="lineno">28</pre><pre class="lineno">29</pre><pre class="lineno">30</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Pages</span><span class="o">::</span><span class="no">Base</span> <span class="o">&lt;</span> <span class="no">SitePrism</span><span class="o">::</span><span class="no">Page</span>&#x000A;  <span class="no">MESSAGES</span> <span class="o">=</span> <span class="sx">%i[notice alert success error]</span>&#x000A;  <span class="no">ACTIONS</span> <span class="o">=</span> <span class="sx">%i[signup login logout]</span>&#x000A;&#x000A;  <span class="kp">attr_reader</span> <span class="ss">:expected_title</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">expected_title</span><span class="p">:)</span>&#x000A;    <span class="vi">@expected_title</span> <span class="o">=</span> <span class="n">expected_title</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">has_correct_title?</span>&#x000A;    <span class="n">has_title?</span><span class="p">(</span><span class="vi">@expected_title</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="no">MESSAGES</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>&#x000A;    <span class="n">element</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">m</span><span class="si">}</span><span class="s2">_message"</span><span class="p">,</span> <span class="s2">".alert-</span><span class="si">#{</span><span class="n">m</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="no">ACTIONS</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">action</span><span class="o">|</span>&#x000A;    <span class="n">element</span> <span class="ss">:"</span><span class="si">#{</span><span class="n">action</span><span class="si">}</span><span class="ss">_button"</span><span class="p">,</span> <span class="s2">".</span><span class="si">#{</span><span class="n">action</span><span class="si">}</span><span class="s2">-btn"</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">logged_in?</span>&#x000A;    <span class="n">has_logout_button?</span> <span class="o">&amp;&amp;</span> <span class="n">has_no_login_button?</span> <span class="o">&amp;&amp;</span> <span class="n">has_no_signup_button?</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">logged_out?</span>&#x000A;    <span class="p">(</span><span class="n">has_signup_button?</span> <span class="o">||</span> <span class="n">has_login_button?</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">has_no_logout_button?</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span></pre></td></tr></tbody></table></div>
                <p>The rest is handled by the sign up page object.</p>
                <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre><pre class="lineno">7</pre><pre class="lineno">8</pre><pre class="lineno">9</pre><pre class="lineno">10</pre><pre class="lineno">11</pre><pre class="lineno">12</pre><pre class="lineno">13</pre><pre class="lineno">14</pre><pre class="lineno">15</pre><pre class="lineno">16</pre><pre class="lineno">17</pre><pre class="lineno">18</pre><pre class="lineno">19</pre><pre class="lineno">20</pre><pre class="lineno">21</pre><pre class="lineno">22</pre><pre class="lineno">23</pre><pre class="lineno">24</pre><pre class="lineno">25</pre><pre class="lineno">26</pre><pre class="lineno">27</pre><pre class="lineno">28</pre><pre class="lineno">29</pre><pre class="lineno">30</pre><pre class="lineno">31</pre><pre class="lineno">32</pre><pre class="lineno">33</pre><pre class="lineno">34</pre><pre class="lineno">35</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">Pages::Users</span>&#x000A;  <span class="k">class</span> <span class="nc">Signup</span> <span class="o">&lt;</span> <span class="no">Pages</span><span class="o">::</span><span class="no">Base</span>&#x000A;    <span class="no">FORM</span> <span class="o">=</span> <span class="s1">'#signup-form'</span>&#x000A;&#x000A;    <span class="no">SIGNUP_FIELDS</span> <span class="o">=</span> <span class="sx">%i[email password password_confirmation]</span>&#x000A;&#x000A;    <span class="no">VALID_FORM_DATA</span> <span class="o">=</span> <span class="p">{</span><span class="ss">email: </span><span class="s1">'foo@bar.com'</span><span class="p">,</span>&#x000A;                       <span class="ss">password: </span><span class="s1">'password'</span><span class="p">,</span>&#x000A;                       <span class="ss">password_confirmation: </span><span class="s1">'password'</span><span class="p">}</span>&#x000A;&#x000A;    <span class="no">INVALID_FORM_DATA</span> <span class="o">=</span> <span class="no">SIGNUP_FIELDS</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="o">[</span><span class="n">f</span><span class="p">,</span> <span class="no">SecureRandom</span><span class="p">.</span><span class="nf">hex</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">]</span> <span class="p">}.</span><span class="nf">to_h</span>&#x000A;&#x000A;    <span class="n">set_url</span> <span class="s1">'/signup'</span>&#x000A;    <span class="n">set_url_matcher</span><span class="p">(</span><span class="sr">/signup/</span><span class="p">)</span>&#x000A;&#x000A;    <span class="no">SIGNUP_FIELDS</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>&#x000A;      <span class="n">element</span> <span class="ss">:"</span><span class="si">#{</span><span class="n">f</span><span class="si">}</span><span class="ss">_field"</span><span class="p">,</span> <span class="s2">"#user_</span><span class="si">#{</span><span class="n">f</span><span class="si">}</span><span class="s2">"</span>&#x000A;    <span class="k">end</span>&#x000A;&#x000A;    <span class="n">element</span> <span class="ss">:submit_button</span><span class="p">,</span> <span class="s2">"</span><span class="si">#{</span><span class="no">FORM</span><span class="si">}</span><span class="s2"> input[type='submit']"</span>&#x000A;&#x000A;    <span class="k">def</span> <span class="nf">fill_in_form</span><span class="p">(</span><span class="ss">valid: </span><span class="kp">true</span><span class="p">)</span>&#x000A;      <span class="n">data</span> <span class="o">=</span> <span class="n">valid</span> <span class="p">?</span> <span class="no">VALID_FORM_DATA</span> <span class="p">:</span> <span class="no">INVALID_FORM_DATA</span>&#x000A;      <span class="n">fields</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">data</span><span class="o">[</span><span class="n">f</span><span class="o">]</span><span class="p">)</span> <span class="p">}</span>&#x000A;    <span class="k">end</span>&#x000A;&#x000A;    <span class="k">def</span> <span class="nf">fields</span>&#x000A;      <span class="no">SIGNUP_FIELDS</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="o">[</span><span class="n">f</span><span class="p">,</span> <span class="nb">send</span><span class="p">(</span><span class="ss">:"</span><span class="si">#{</span><span class="n">f</span><span class="si">}</span><span class="ss">_field"</span><span class="p">)</span><span class="o">]</span> <span class="p">}.</span><span class="nf">to_h</span>&#x000A;    <span class="k">end</span>&#x000A;&#x000A;    <span class="k">def</span> <span class="nf">create_account</span>&#x000A;      <span class="n">submit_button</span><span class="p">.</span><span class="nf">click</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span></pre></td></tr></tbody></table></div>
                <p>And finally, the <code>App</code> object:</p>
                <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre><pre class="lineno">7</pre><pre class="lineno">8</pre><pre class="lineno">9</pre><pre class="lineno">10</pre><pre class="lineno">11</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">Pages</span>&#x000A;  <span class="k">class</span> <span class="nc">App</span>&#x000A;    <span class="k">def</span> <span class="nf">home</span>&#x000A;      <span class="no">Home</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">expected_title: </span><span class="s1">'Home'</span><span class="p">)</span>&#x000A;    <span class="k">end</span>&#x000A;&#x000A;    <span class="k">def</span> <span class="nf">signup</span>&#x000A;      <span class="no">Users</span><span class="o">::</span><span class="no">Signup</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">expected_title: </span><span class="s1">'Sign up'</span><span class="p">)</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span></pre></td></tr></tbody></table></div>
                <p>At this point, I bet I know what you&rsquo;re thinking&hellip;</p>
                
                <blockquote>
                <p>Yeah well this is great and all but it&rsquo;s also so much more work for that simple
                initial spec! It would have been easier to just keep it the way it was. All
                you&rsquo;ve done is moved your coupling to the view into a different file and tripled
                the number of lines of code in the process. But I guess the feature spec is more
                readable&hellip; Hmmm&hellip;</p>
                </blockquote>
                
                <p>And that&rsquo;s exactly the point. I have just moved the details of the view. One
                key difference, though, is that I&rsquo;ve moved them out of a place where they aren&rsquo;t
                at all the focal point and don&rsquo;t belong (the feature spec). Where they
                have been moved to, meanwhile, is designed specifically for them. The result of
                this effort is not just more readable specs, however. I&rsquo;ve also encapsulated
                application-wide behavior with the <code>Base</code> page object (remember those <code>&#39;.alert&#39;</code>
                selectors?) and gained a great deal of reusability across feature specs. Finally,
                I&rsquo;ve also made the tests easier to expand in the future, which will inevitably
                happen (it did for me and my application is still pretty small at this point in
                time).</p>
                
                <p>Anyway, that about wraps this one up. I had fun learning about page objects
                and incorporating them into my project and they have already paid off with some
                of my recent refactorings (even in my project&rsquo;s JavaScript). Hopefully you got
                something useful out of this too!</p>
              </div>
            </article>
            <hr class='post-separator'>
            <article>
              <header>
                <h3><a href="/blog/2014/01/testing-and-a-capybara-tip/">Testing and a Capybara tip</a></h3>
                <p class='blog-stamp'>
                  <time datetime='2014-01-15 17:16:00 -0500'>Jan 15, 2014</time>
                </p>
              </header>
              <div class='content-article'>
                <p>When I first started learning Ruby one of the things that I read and heard over
                and over again was how great the libraries for testing were. Coming from
                C# and .NET, I had spent a lot of time working with <a href="http://www.specflow.org/">SpecFlow</a>,
                <a href="https://code.google.com/p/mb-unit/">mb-unit</a>, and <a href="https://github.com/ayende/rhino-mocks">Rhino Mocks</a> in a TDD/BDD-ish environment.
                I already knew how incredibly useful a good test suite was and how much more
                efficient it could allow you to be when it came to making new features and
                refactoring old ones.</p>
                
                <p>What I didn&rsquo;t realize, though, was the extent to which Rubyists tested their
                applications. In .NET, everything was heavily unit tested. Although we wrote
                Cucumber-style specs, they were mainly being used as a more readable alternative
                to the plain xUnit-style tests. We stuck with plain old unit tests with mocked
                dependencies and relied on manual testing (or sometimes our CI server) to catch
                issues with integration. It was a pain.</p>
                
                <p>Meanwhile, plenty of Rubyists had already been using tons of great testing
                libraries. What was crazy about it all of it, to me at least, was what they
                were able to test with gems like Capybara (or Rack::Test/Webrat before that).
                Although I&rsquo;ve since managed to pick up the pieces, the revelation that
                you could test an entire application (JavaScript included) with straightforward
                tests/specs in Ruby blew my mind.</p>
                
                <p><img title="Totally relevant" alt="mind-blown" src="/blog/2014/01/testing-and-a-capybara-tip/mind-blown.gif" /></p>
                
                <p>In my newest project, for example, I&rsquo;ve been using Capybara with
                <a href="https://github.com/jonleighton/poltergeist">Poltergeist</a>. Whenever I&rsquo;m using Capybara, I tend to want to
                just play with the API. This can be done by just fiddling with my tests and
                constantly rerunning them, but I found an even simpler way to just use
                Capybara from Pry or IRB with this script (<code>pry_capybara.rb</code>):</p>
                <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre></td><td class="code"><pre><span class="c1"># Simple script to be able to quickly interact with the capybara API from pry</span>&#x000A;&#x000A;<span class="nb">require</span> <span class="s1">'capybara/poltergeist'</span>&#x000A;<span class="no">Capybara</span><span class="p">.</span><span class="nf">run_server</span> <span class="o">=</span> <span class="kp">false</span>&#x000A;<span class="no">Capybara</span><span class="p">.</span><span class="nf">current_driver</span> <span class="o">=</span> <span class="ss">:poltergeist</span>&#x000A;<span class="kp">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span></pre></td></tr></tbody></table></div>
                <p>Capybara will complain about being included in the global scope, but as long as
                you are just using this for one-off Pry sessions, it shouldn&rsquo;t matter. You can
                use it like this:</p>
                <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre><pre class="lineno">7</pre><pre class="lineno">8</pre><pre class="lineno">9</pre><pre class="lineno">10</pre><pre class="lineno">11</pre><pre class="lineno">12</pre><pre class="lineno">13</pre><pre class="lineno">14</pre><pre class="lineno">15</pre><pre class="lineno">16</pre><pre class="lineno">17</pre><pre class="lineno">18</pre><pre class="lineno">19</pre></td><td class="code"><pre><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">require_relative</span> <span class="s1">'pry_capybara'</span>&#x000A;<span class="n">including</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span> <span class="k">in</span> <span class="n">the</span> <span class="n">global</span> <span class="n">scope</span> <span class="n">is</span> <span class="n">not</span> <span class="n">recommended!</span>&#x000A;<span class="o">=&gt;</span> <span class="kp">true</span>&#x000A;&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="c1"># if you are running your server locally</span>&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">visit</span> <span class="s1">'http://localhost:3000'</span>&#x000A;<span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"status"</span><span class="o">=&gt;</span><span class="s2">"success"</span><span class="p">}</span>&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">title</span>&#x000A;<span class="o">=&gt;</span> <span class="s2">"MyApp"</span>&#x000A;&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="c1"># or if you want to just mess around with any site</span>&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">visit</span> <span class="s1">'https://news.ycombinator.com'</span>&#x000A;<span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"status"</span><span class="o">=&gt;</span><span class="s2">"success"</span><span class="p">}</span>&#x000A;<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">all</span><span class="p">(</span><span class="s1">'.title &gt; a'</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:text</span><span class="p">).</span><span class="nf">first</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>&#x000A;<span class="o">=&gt;</span> <span class="o">[</span><span class="s2">"Super successful companies"</span><span class="p">,</span>&#x000A; <span class="s2">"Show HN: Kimono – Never write a web scraper again"</span><span class="p">,</span>&#x000A; <span class="s2">"The Productivity Cycle"</span><span class="p">,</span>&#x000A; <span class="s2">"Coming soon: Stripe CTF3, distributed systems edition"</span><span class="p">,</span>&#x000A; <span class="s2">"List of languages that compile to JS"</span><span class="o">]</span></pre></td></tr></tbody></table></div>
                <p>Although it&rsquo;s small and very simple, it&rsquo;s been really useful to me for when I&rsquo;m
                writing feature specs and (soon to be discussed in another post) page objects.</p>
                
                <p>I know what you must be thinking by now though&hellip;</p>
                
                <blockquote>
                <p>&ldquo;It&rsquo;s 2014! We&rsquo;ve been doing this kind of thing for years! We&rsquo;re
                even doing this in JavaScript now! Get with the times!&rdquo;</p>
                </blockquote>
                
                <p>Although you&rsquo;d be right to think such a thing, it&rsquo;s still a bit crazy how
                powerful libraries like these are. And this is only for testing. Don&rsquo;t even get
                me started on the ridiculousness of the <a href="http://oridomi.com/">origami-image-folding</a>,
                <a href="http://theonion.github.io/fartscroll.js/">fart-scrolling</a>, <a href="https://developer.mozilla.org/en-US/demos/detail/bananabread">first-person-shooter&#39;ing</a> that
                is the current state of JavaScript.</p>
              </div>
            </article>
          </section>
        </section>
      </div>
    </div>
    <footer class='footer'>
      <p>
        <small>
          © 2014 Charles B Johnson. Made with
          <a href="http://middlemanapp.com/">Middleman</a>
          and
          <a href="https://github.com/charlesbjohnson/cbjohnson.info">GitHub</a>.
        </small>
      </p>
    </footer>
  </body>
</html>
